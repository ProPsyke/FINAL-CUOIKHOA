<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
</head>

<body class="">
  <nav class="navbar navbar-expand-lg ms-5 mt-4 mb-3">
    <div class="" style="margin-left: 22%">
      <input type="text" id="search" placeholder="Type Email or Username">
      <button id="bleh" onclick="SearchData()" class="btn btn-primary">
        click
      </button>
    </div>
    <div class="" style="margin-left: 33%">
      <button class="btn btn-light" onclick="NTFP()">Food</button>
      <button class="btn btn-primary" onclick="NTUP()">User</button>
    </div>
    <div>
      <h5 style="margin-left: 40px" id="Profile">Profile</h5>
    </div>
  </nav>
  <div class="ms-4 pe-5 pt-2 position-fixed border-end border-2"
    style="top: 2%; height: 100%; display: flex; flex-direction: column;">
    <h1>Food List</h1>
    <div>
      <li class="dropdown">
        <h5 href="javascript:void(0)" class="dropbtn">. Manage</h5>
        <div class="dropdown-content">
          <a href="./usuk.html">User</a>
          <a href="./index.html">Food</a>
        </div>
      </li>
    </div>
    <h5 class="web" id="w">. Web</h5>
  </div>
  <div style="margin-left: 25%; width: 70%; display: flex; justify-content: space-between; height: 20vh;"
    class=" border-bottom border-2 pb-4">
    <div class="border-2 border" style="width: 24%" id="box1">1</div>
    <div class="border-2 border" style="width: 24%" id="box2">
      2
    </div>
    <div id="box4" class="border-2 border" style="width: 24%">
      3
    </div>
    <div id="box5" class="border-2 border" style="width: 24%">
      4
    </div>
  </div>
  <!-- <canvas
      id="myChart"
      style="width: 100px; max-width: 750px; height: 45px; margin-left: 25%"
    ></canvas> -->
  <div style="margin-left: 25%" class="">
    <ul id="user-list"></ul>
    <table id="testing" class="border border-2 border-black">
      <tr class="border border-2 border-black">
        <th class="ps-1">Name</th>
        <th class="ps-3">Email</th>
        <th class="ps-1">Role</th>
        <th class="ps-3 pe-3">Edit</th>
      </tr>
    </table>
  </div>
  <style>
    #Profile {
      cursor: pointer;
    }

    li {
      float: left;
    }

    .web {
      padding: 10px 16px;
      cursor: pointer;
    }

    li a,
    .dropbtn {
      cursor: pointer;
      color: black;
      display: inline-block;
      text-align: center;
      padding: 10px 16px;
      text-decoration: none;
    }

    .dropdown {
      display: block;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
      z-index: 1;
    }

    .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: left;
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    const firebaseConfig = {
      apiKey: "AIzaSyB5CBskeDYo_DpeskcP7B4K0qKwuGvtnn0",
      authDomain: "foodpsykes.firebaseapp.com",
      projectId: "foodpsykes",
      storageBucket: "foodpsykes.appspot.com",
      messagingSenderId: "429664914347",
      appId: "1:429664914347:web:6d1e41cf493d55561de0ee",
      measurementId: "G-86M6HF41TQ",
    };
    import {
      deleteUser,
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import {
      onValue,
      getDatabase,
      ref,
      set,
      push,
      child,
      remove,
      update,
      get,
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    window.loadUsers = function () {
      const table = document.getElementById('testing')
      const userList = document.getElementById("user-list");
      userList.innerHTML = ``;
      const usersRef = ref(database, "users");
      onValue(usersRef, (snapshot) => {
        userList.innerHTML = ``
        snapshot.forEach((childSnapshot) => {
          const user = childSnapshot.val();
          const userId = childSnapshot.key
          const x = document.createElement('tr')
          x.innerHTML = `<tr>
               <td>${user.username}</td>
               <td>${user.email}</td>
               <td>${user.Role}</td>
               <td>
                <button class=" bg-primary text-light border-0 ms-1" onclick="DeleteUser('${userId}')">Delete</button>
               </td>
              </tr>`
          table.appendChild(x);
          console.log("ok");
        });
      });
    };
    window.DeleteUser = function (userId) {
      if (confirm('Sure this isnt a miss click and you want to delete this user?')) {
        const userRef = ref(database, 'users/' + userId)
        remove(userRef)
          .then(() => { window.location.href = 'http://127.0.0.1:5500/BAILAM/usuk.html' })
          .catch((error) => {
            console.error(error)
          })
      }
    }
    loadUsers();
    const p = document.getElementById('Profile')
    p.addEventListener('click', () => {
      window.location.href = 'http://127.0.0.1:5500/code/profile.html'
    })
    window.NTFP = function () {
      window.location.href = 'http://127.0.0.1:5500/code/FoodList.html'
    }
    window.NTUP = function () {
      window.location.href = 'http://127.0.0.1:5500/code/usuk.html'
    }
    const SearchInput = document.getElementById('search')
    window.SearchData = function () {
      const keyword = SearchInput.value.toLowerCase();
      const usersRef = ref(database, "users");
      onValue(usersRef, (snapshot) => {
        const table = document.getElementById('testing')
        table.innerHTML = ``;
        snapshot.forEach((childSnapshot) => {
          const userData = childSnapshot.val();
          const userId = childSnapshot.key;
          if (userData.email.toLowerCase().includes(keyword) || userData.username.toLowerCase().includes(keyword)) {
            const x = document.createElement('tr')
            x.innerHTML = `<tr>
               <td>${userData.username}</td>
               <td>${userData.email}</td>
               <td>${userData.Role}</td>
               <td>
                <button class=" bg-primary text-light border-0 ms-1" onclick="DeleteUser('${userId}')">Delete</button>
               </td>
              </tr>`;
            table.appendChild(x);
          }
        });
        if (table.innerHTML === "") {
          const x = document.createElement("tr");
          x.innerHTML = `<tr><td>No result found</td></tr>`;
          table.appendChild(x)
        }
      })
    }
    document.getElementById('w').addEventListener('click', () => {
      window.location.href = "http://127.0.0.1:5500/code/index.html"
    })
  </script>
</body>

</html>