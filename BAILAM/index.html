<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body class="">
  <nav class="navbar navbar-expand-lg ms-5 mt-4 mb-3">
    <div class="" style="margin-left: 22%;">
      <input type="text" id="search" placeholder="Type Name or Type" />
      <button id="bleh" onclick="SearchData()" class="btn btn-primary">
        click
      </button>
    </div>
    <div class="" style="margin-left: 33%">
      <button class="btn btn-primary" onclick="NTFP()">Food</button>
      <button class="btn btn-light" onclick="NTUP()">User</button>
    </div>
    <div>
      <h5 style="margin-left: 40px" id="Profile">Profile</h5>
    </div>
  </nav>
  <div class="ms-4 pe-5 pt-2 position-fixed border-end border-2"
    style="top: 2%; height: 100vh; display: flex; flex-direction: column;">
    <h1>Food List</h1>
    <div>
      <li class="dropdown">
        <h5 href="javascript:void(0)" class="dropbtn">. Manage</h5>
        <div class="dropdown-content">
          <a href="http://127.0.0.1:5500/BAILAM/usuk.html">User</a>
          <a href="http://127.0.0.1:5500/BAILAM/index.html">Food</a>
        </div>
      </li>
    </div>
    <h5 class="web">. Web</h5>

  </div>
  <div style="margin-left: 25%; width: 70%; display: flex; justify-content: space-between; height: 20vh"
    class="border-bottom border-2 pb-4">
    <div class="border-2 border" style="  width: 24%;" id="box1">1</div>
    <div class="border-2 border" style="width: 24%;" id="box2">
      2
    </div>
    <div id="box4" class="border-2 border " style="width: 24%;">
      3
    </div>
    <div id="box5" class="border-2 border" style="width: 24%;">
      4
    </div>
  </div>
  <!-- <canvas
      id="myChart"
      style="width: 100px; max-width: 750px; height: 45px; margin-left: 25%"
    ></canvas> -->
  <div style="margin-left: 25%" class="" id="foodList">
    <!-- <ul id="food-list"></ul>
    <table id="testing" class="border border-2 border-black">
      <tr class="border border-2 border-black">
        <th class="ps-1">Section</th>
        <th class="ps-2">Name</th>
        <th class="ps-1">Type</th>
        <th class="p-1">Price</th>
        <th class="text-center">Ingredients</th>
        <th class="ps-5">Description</th>
        <th class="ps-5">Edit</th>
      </tr>
    </table> -->
    <h2>Seasonal Specialty</h2>
    <table id="seasonalSpecialty" class="dish-section">
      <tbody></tbody>
    </table>
    <h2>Popular Choice</h2>
    <table id="popularChoice" class="dish-section">
      <tbody></tbody>
    </table>
    <h2>Best Combo</h2>
    <table id="bestCombo" class="dish-section">
      <tbody></tbody>
    </table>
    <button id="new" class="btn btn-primary position-fixed" style="top: 92%; left: 92%; border-radius: 50%;"><i
        class="fa-solid fa-plus"></i></button>
  </div>
  <style>
    li {
      float: left;
    }

    .web {
      padding: 10px 16px;
      cursor: pointer;
    }

    li a,
    .dropbtn {
      cursor: pointer;
      color: black;
      display: inline-block;
      text-align: center;
      padding: 10px 16px;
      text-decoration: none;
    }

    .dropdown {
      display: block;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
      z-index: 1;
    }

    .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: left;
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    p {
      font-size: 12px;
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    const firebaseConfig = {
      apiKey: "AIzaSyAoBVcu8wGcLOy58iUpf5atiVFl3sQvp00",
      authDomain: "newiguess-6075f.firebaseapp.com",
      projectId: "newiguess-6075f",
      storageBucket: "newiguess-6075f.firebasestorage.app",
      messagingSenderId: "265431246225",
      appId: "1:265431246225:web:dc550005726e55d2c0a630",
      measurementId: "G-V7X62BD2DV",
    };
    import {
      getDatabase,
      ref,
      set,
      push,
      onValue,
      child,
      remove,
      update,
      get,
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
    let allFoods = [];
    const app = initializeApp(firebaseConfig);
    const database = getDatabase();
    window.renderDishes = function () {
      const sections = ["seasonalSpecialty", "popularChoice", "bestCombo"];
      sections.forEach((section) => {
        const sectionRef = ref(database, section)
        const sectionTable = document.getElementById(section).querySelector("tbody")
        if (!sectionTable) {
          console.log('notFound');
          return;
        }
        onValue(sectionRef, (snapshot) => {
          sectionTable.innerHTML = "";
          if (snapshot.exists()) {
            const dishes = snapshot.val();
            let row;
            let cellCount = 0;
            for (const dishId in dishes) {
              const dish = dishes[dishId];
              if (cellCount % 4 === 0) {
                row = document.createElement('tr');
                sectionTable.appendChild(row)
              }
              const cell = document.createElement("td");
              cell.innerHTML = `<div class="dish-card">
                <b style="width: 200px">${dish.Name}</b>
                <div><p>${dish.Type}</p>
                <p>${dish.Price}</p>
                <p style="width: 200px">${dish.Ingredients}</p>
                <p style="width: 200px">${dish.Des}</p></div>
                <div style="display: flex">
                  <button class="btn btn-primary" onclick="editFood('${section}','${dishId}','${encodeURIComponent(JSON.stringify(dish))}')">Edit</button>
                  <button class="btn" onclick="deleteFood('${section}','${dishId}')">Delete</button>
                  </div>
                </div>`;
              row.appendChild(cell);
              cellCount++
            }
            while (cellCount % 4 !== 0) {
              const emptyCell = document.createElement("td")
              emptyCell.innerHTML = "";
              row.appendChild(emptyCell);
              cellCount++;
            }
          } else {
            sectionContainer.innerHTML = `<p>No Dishes Available</p>`
          }
        })
      })
    }
    renderDishes()
    document.addEventListener("DOMContentLoaded", function () {
      renderDishes()
    })
    window.deleteFood = function (section, dishId) {
      const dishRef = ref(database, `${section}/${dishId}`);
      remove(dishRef)
        .then(() => { alert("đã xoá"); renderDishes(); })
        .catch((error) => console.log("lỗi:", error));
    };
    window.SearchData = function () {
      const dbSearch = ref(database);
      get(
        child(dbSearch, "foods/" + document.getElementById("search").value)
      ).then((item) => {
        if (item.exists()) {
          console.log(item);
          console.log(item.Name);
        }
      });
      const searchBox = document.getElementById("search");
      const searchTerm = searchBox.value.toLowerCase();
      const list = document.getElementById("food-list");
      const table = document.getElementById("testing");
      table.innerHTML = `<tr class="border border-2 border-black">
                    <th class="ps-1">Name</th>
                    <th class="ps-3">Type</th>
                    <th class="p-1">Price</th>
                    <th class="text-center">Ingredients</th>
                    <th class="ps-5">Description</th>
                    <th class="ps-5">Edit</th>
                  </tr>`;
      list.innerHTML = "";
      const filteredFood = allFoods.filter(
        (food) =>
          food.Name.toLowerCase().includes(searchTerm) ||
          food.Type.toLowerCase().includes(searchTerm)
      );
      filteredFood.forEach((food) => displayFood(food, food.key));
    };
    window.editFood = function (section, dishId, dishData) {
      const dish = JSON.parse(decodeURIComponent(dishData))
      const formHtml = `
        <div id="editForm" style="position:fixed;top:50%;left:50%;transform:translate(-50%, -50%);
        padding:20px;background:white;box-shadow: 0px 0px 10px rgba(0,0,0,0.2)">
           <h3>Edit Dish</h3>
           <label>Name:<input type="text" id="editName" value="${dish.Name}"></label><br>
           <label>Type:<input type="text" id="editType" value=${dish.Type}></label><br>
           <label>Price:<input type="text" id="editPrice" value="${dish.Price}"></label><br>
           <label>Ingredients:<input type="text" id="editIngredients" value=${dish.Ingredients}></label><br>
           <label>Description:<input type="text" id="editDescription" value="${dish.Des}"></label><br>
           <div>
            <button onclick="saveFood('${section}','${dishId}')">Save</button>
            <button onclick="closeEditForm()">Cancel</button>
            </div>
        </div>`;
      document.body.insertAdjacentHTML("beforeend", formHtml)
      // console.log(key, Name, Type, Price, Ingredients, Des);
      // const newName = prompt("Tên mới", Name);
      // const newType = prompt("Phân Loại mới", Type);
      // const newPrice = prompt("Giá Mới", Price);
      // const newIn = prompt("Nguyên Liệu Mới", Ingredients);
      // const newDes = prompt("Mô tả mới", Des);
      // if (newName && newType && newPrice && newIn && newDes) {
      //   const foodRef = ref(database, "foods/" + key);
      //   update(foodRef, {
      //     Name: newName,
      //     Type: newType,
      //     Price: newPrice,
      //     Ingredients: newIn,
      //     Des: newDes,
      //   })
      //     .then(() => alert("ok"))
      //     .catch((error) => console.log(error));
      // }
    };
    window.closeEditForm = function () {
      const editForm = document.getElementById("editForm");
      if (editForm) {
        editForm.remove();
      }
    }
    window.saveFood = function (section, dishId) {
      const updateDish = {
        Name: document.getElementById("editName").value,
        Type: document.getElementById("editType").value,
        Price: document.getElementById("editPrice").value,
        Ingredients: document.getElementById("editIngredients").value,
        Des: document.getElementById("editDescription").value,
      }
      const dishRef = ref(database, `${section}/${dishId}`);
      update(dishRef, updateDish)
        .then(() => {
          alert('Update Successfully');
          closeEditForm();
          renderDishes();
        })
        .catch((error) => {
          console.error(error)
        })
    }
    const new1 = document.getElementById("new");
    new1.addEventListener("click", () => {
      window.location.href = "http://127.0.0.1:5500/BAILAM/create.html";
    });
    window.showStatistics = function () {
      // const totalFoods = allFoods.length;
      // const typeCount = allFoods.reduce((count, food) => {
      //   (count[food.Type] || 0) + 1;
      //   return count;
      // }, {});
      // const b1 = document.getElementById('box1')
      // const b2 = document.getElementById('box2')
      // b1.innerHTML = `Tổng Món Ăn <h2>${totalFoods}</h2>`
      // console.log('Số món theo loại', typeCount)
    }
    window.NTFP = function () {
      window.location.href = 'http://127.0.0.1:5500/BAILAM/index.html'
    }
    window.NTUP = function () {
      window.location.href = 'http://127.0.0.1:5500/BAILAM/usuk.html'
    }
    const p = document.getElementById('Profile')
    p.addEventListener('click', () => {
      window.location.href = 'http://127.0.0.1:5500/code/profile.html'
    })
    const h = document.querySelector(".web");
    h.addEventListener('click', () => {
      window.location.href = 'http://127.0.0.1:5500/BAILAM/MainPage.html'
    })
  </script>
  <style>
    .dish-section {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      display: flex;
    }

    .dish-section td {
      border: 1px solid #ccc;
      vertical-align: top;
      padding: 10px;
    }

    .dish-card {
      /* border: 1px solid; */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
  </style>
</body>

</html>